---
icon: cib:socket-io
---

# WebSockets

> H3 has built-in support for cross platform WebSocket and Server-Sent Events.

H3 has built-in, runtime agnostic [WebSocket](https://developer.mozilla.org/en-US/docs/Web/API/WebSocket) support using [ðŸ”Œ CrossWS](https://crossws.unjs.io/).

:read-more{title="CrossWS" to="https://crossws.unjs.io/"}

## Usage

<!-- automd:file code src="../../examples/websocket.ts" -->

```ts [websocket.ts]
import { H3, defineWebSocketHandler } from "h3";

export const app = new H3();

app.use(() =>
  fetch(
    "https://raw.githubusercontent.com/unjs/crossws/main/examples/h3/public/index.html",
  ).then((r) => r.text()),
);

app.use(
  "/_ws",
  defineWebSocketHandler({
    open(peer) {
      console.log("[ws] open", peer);
    },

    message(peer, message) {
      console.log("[ws] message", peer, message);
      if (message.text().includes("ping")) {
        peer.send("pong");
      }
    },

    close(peer, event) {
      console.log("[ws] close", peer, event);
    },

    error(peer, error) {
      console.log("[ws] error", peer, error);
    },
  }),
);

```

<!-- /automd -->

## Server-Sent Events (SSE)

As an alternative to WebSockets, you can use [Server-sent events](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events).

H3 has a built-in API to create server-sent events using `createEventStream(event)` utility.

### Example

<!-- automd:file code src="../../examples/server-sent-events.ts" -->

```ts [server-sent-events.ts]
import { H3, createEventStream } from "h3";

export const app = new H3();

app.get("/", (event) => {
  const eventStream = createEventStream(event);

  // Send a message every second
  const interval = setInterval(async () => {
    await eventStream.push("Hello world");
  }, 1000);

  // cleanup the interval when the connection is terminated or the writer is closed
  eventStream.onClosed(() => {
    clearInterval(interval);
  });

  return eventStream.send();
});

```

<!-- /automd -->
